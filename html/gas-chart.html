<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Gas Chart</title>
  <link rel="icon" href="img/logo.ico" />

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous" />

  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <div class="layer"></div>
  <!-- ! Body -->
  <a class="skip-link sr-only" href="#skip-target">Skip to content</a>
  <div class="page-flex">
    <!-- ! Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-start">
        <div class="sidebar-head">
          <a href="index.html" class="logo-wrapper" title="Home">
            <span class="sr-only">Home</span>
            <span class="icon logo" aria-hidden="true"></span>
            <div class="logo-text">
              <span class="logo-title">Carbonster</span>
            </div>
          </a>
          <button class="sidebar-toggle transparent-btn" title="Menu" type="button">
            <span class="sr-only">Toggle menu</span>
            <span class="icon menu-toggle" aria-hidden="true"></span>
          </button>
        </div>
        <div class="sidebar-body">
          <ul class="sidebar-body-menu">
            <li>
              <a href="index.html"><span class="icon home" aria-hidden="true"></span>Home</a>
            </li>
            <li>
              <a href="statistic.html"><span class="icon category" aria-hidden="true"></span>Statistic</a>
            </li>
            <li>
              <a href="carbon-corre.html"><span class="icon star" aria-hidden="true"></span>CO2
                Correlation</a>
            </li>
            <li>
              <a href="emission.html"><span class="icon chart-icon" aria-hidden="true"></span>Emission</a>
            </li>
            <li>
              <a href="emission-person.html"><span class="icon chart-icon" aria-hidden="true"></span>Emission per
                Person</a>
            </li>
            <li>
              <a class="show-cat-btn" href="##">
                <span class="icon graph" aria-hidden="true"></span>Air Quality
                <span class="category__btn transparent-btn rotated" title="Open list">
                  <span class="sr-only">Open list</span>
                  <span class="icon arrow-down" aria-hidden="true"></span>
                </span>
              </a>
              <ul class="cat-sub-menu visible">
                <li>
                  <a href="gas-chart.html?code=TH&title=Thailand">
                    <span class="icon thailand" aria-hidden="true"></span>Thailand</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=JP&title=Japan"><span class="icon japan"
                      aria-hidden="true"></span>Japan</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=KR&title=South Korea"><span class="icon south-korea"
                      aria-hidden="true"></span>South Korea</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=TW&title=Taiwan, Province of China"><span class="icon taiwan"
                      aria-hidden="true"></span>Taiwan</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=US&title=United States"><span class="icon united-states"
                      aria-hidden="true"></span>United States</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=AU&title=Australia"><span class="icon australia"
                      aria-hidden="true"></span>Australia</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=GB&title=United Kingdom"><span class="icon united-kingdom"
                      aria-hidden="true"></span>United Kingdom</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=RU&title=Russian"><span class="icon russia"
                      aria-hidden="true"></span>Russian</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=IN&title=India"><span class="icon india"
                      aria-hidden="true"></span>India</a>
                </li>
              </ul>
            </li>
            <li>
              <a class="show-cat-btn" href="##">
                <span class="icon graph" aria-hidden="true"></span>Thai Air
                Quality
                <span class="category__btn transparent-btn rotated" title="Open list">
                  <span class="sr-only">Open list</span>
                  <span class="icon arrow-down" aria-hidden="true"></span>
                </span>
              </a>
              <ul class="cat-sub-menu visible">
                <li>
                  <a href="gas-chart.html?code=Bangkok&title=Bangkok"><span class="icon thailand"
                      aria-hidden="true"></span>Bangkok</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=Narathiwat&title=Narathiwat"><span class="icon thailand"
                      aria-hidden="true"></span>Narathiwat</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=KhonKaen&title=Khon Kaen"><span class="icon thailand"
                      aria-hidden="true"></span>Khon Kaen</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=Rayong&title=Rayong"><span class="icon thailand"
                      aria-hidden="true"></span>Rayong</a>
                </li>
                <li>
                  <a href="gas-chart.html?code=ChiangMai&title=Chiang Mai"><span class="icon thailand"
                      aria-hidden="true"></span>Chiang Mai</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </aside>
    <div class="main-wrapper">
      <!-- ! Main nav -->
      <nav class="main-nav--bg">
        <div class="main-nav">
          <div class="main-nav-end mx-4">
            <button class="sidebar-toggle transparent-btn" title="Menu" type="button">
              <span class="sr-only">Toggle menu</span>
              <span class="icon menu-toggle--gray" aria-hidden="true"></span>
            </button>
          </div>
        </div>
      </nav>
      <!-- ! Main -->
      <main class="main users chart-page" id="skip-target">
        <div class="container">
          <h1 id="title"></h1>
          <br /><br />
          <h3 id="error"></h3>
          <div id="chart" style="width: 100%; height: 75vh"></div>
        </div>
      </main>
    </div>
  </div>

  <script>
    var url = new URL(window.location.href);
    var code = url.searchParams.get("code");
    var inThai = code.length != 2;
    var title = url.searchParams.get("title");
    document.getElementById("title").innerHTML = title;

    if (inThai) {
      var body = JSON.stringify({
        query: `
              {
                airQualityTH(province: "${code}") {
                  date
                  carbonmonoxide
                  methane
                  ozone
                }
              }`,
      });
    } else {
      var body = JSON.stringify({
        query: `
              {
                airQuality(country: "${code}") {
                  date
                  carbonmonoxide
                  methane
                  ozone
                }
              }`,
      });
    }

    async function createChart() {
      var resp = await fetch("http://localhost:3000/graphql", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Accept: "application/json",
        },
        body: body,
      });
      var json = await resp.json();
      var table = json.data;
      // console.log(table)

      if (inThai) {
        if (table.airQualityTH == null) {
          document.getElementById("error").innerHTML = "Still No Data";
          return;
        }
        var data = [
          {
            x: table.airQualityTH.map((row) => row.date),
            y: table.airQualityTH.map((row) => row.carbonmonoxide),
            type: "line",
            name: "carbonmonoxide",
          },
          {
            x: table.airQualityTH.map((row) => row.date),
            y: table.airQualityTH.map((row) => row.methane),
            type: "line",
            name: "methane",
          },
          {
            x: table.airQualityTH.map((row) => row.date),
            y: table.airQualityTH.map((row) => row.ozone),
            type: "line",
            name: "ozone",
          },
        ];
      } else {
        if (table.airQuality == null) {
          document.getElementById("error").innerHTML = "Still No Data";
          return;
        }
        var data = [
          {
            x: table.airQuality.map((row) => row.date),
            y: table.airQuality.map((row) => row.carbonmonoxide),
            type: "line",
            name: "carbonmonoxide",
          },
          {
            x: table.airQuality.map((row) => row.date),
            y: table.airQuality.map((row) => row.methane),
            type: "line",
            name: "methane",
          },
          {
            x: table.airQuality.map((row) => row.date),
            y: table.airQuality.map((row) => row.ozone),
            type: "line",
            name: "ozone",
          },
        ];
      }

      var layout = {
        title: "Average Gas Volume for " + title,
        xaxis: {
          title: "Date",
        },
        yaxis: {
          title: "Gas Volume (mol/m2)",
          range: [0, 0.5],
        },
      };
      var config = { responsive: true };
      Plotly.newPlot("chart", data, layout, config);
    }
    createChart();
  </script>
  <!-- Icons library -->
  <script src="plugins/feather.min.js"></script>
  <!-- Custom scripts -->

  <script src="js/script.js"></script>
  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
</body>

</html>